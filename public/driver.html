<!DOCTYPE html>
<html>
<head>
  <title>Driver â€“ Live Location</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<h2>ğŸš Driver Location Sharing</h2>

<input id="busId" placeholder="Enter Bus ID (BUS101)" />
<button onclick="start()">Start Sharing</button>

<p id="status"></p>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const status = document.getElementById("status");

  function start() {
    const busId = document.getElementById("busId").value.trim();
    if (!busId) {
      alert("Please enter Bus ID");
      return;
    }

    if (!navigator.geolocation) {
      alert("Geolocation not supported");
      return;
    }

    status.innerText = "ğŸ“¡ Waiting for GPS permission...";

    navigator.geolocation.watchPosition(
      position => {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;

        socket.emit("driverLocation", {
          busId,
          lat,
          lon
        });

        status.innerText = `ğŸ“ Sending location: ${lat.toFixed(5)}, ${lon.toFixed(5)}`;
      },
      error => {
        status.innerText = "âŒ Location permission denied";
      },
      {
        enableHighAccuracy: true,
        maximumAge: 0,
        timeout: 10000
      }
    );
  }
</script>

</body>
</html>
