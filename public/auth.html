<!DOCTYPE html>
<html>
<head>
<title>Bus Tracking – Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background: #f3f4f6;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
}

.card {
    background: white;
    padding: 25px;
    width: 300px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

input, select, button {
    width: 100%;
    padding: 8px;
    margin-top: 10px;
}

button {
    background: #2563eb;
    color: white;
    border: none;
    cursor: pointer;
}

.toggle {
    margin-top: 15px;
    text-align: center;
    color: #2563eb;
    cursor: pointer;
}

#roleBox {
    display: none;
}

#msg {
    color: red;
    font-size: 14px;
}
</style>
</head>
<body>

<div class="card">
    <h3 id="title">Sign In</h3>

    <input id="username" placeholder="Username">
    <input id="password" type="password" placeholder="Password">

    <div id="roleBox">
        <select id="role">
            <option value="user">Passenger</option>
            <option value="driver">Driver</option>
            <option value="admin">Admin</option>
        </select>
    </div>

    <button onclick="submit()">Sign In</button>

    <p id="msg"></p>

    <div class="toggle" onclick="toggleMode()">
        Don’t have an account? Sign Up
    </div>
</div>

<script src="auth.js"></script>
<script>
let mode = "signin"; // signin | signup

function toggleMode() {
    const title = document.getElementById("title");
    const roleBox = document.getElementById("roleBox");
    const btn = document.querySelector("button");
    const toggle = document.querySelector(".toggle");

    if (mode === "signin") {
        mode = "signup";
        title.innerText = "Sign Up";
        roleBox.style.display = "block";
        btn.innerText = "Create Account";
        toggle.innerText = "Already have an account? Sign In";
    } else {
        mode = "signin";
        title.innerText = "Sign In";
        roleBox.style.display = "none";
        btn.innerText = "Sign In";
        toggle.innerText = "Don’t have an account? Sign Up";
    }
}

function submit() {
    const username = document.getElementById("username").value;
    const password = document.getElementById("password").value;

    if (!username || !password) {
        msg.innerText = "Enter all fields";
        return;
    }

    if (mode === "signup") {
        fetch("/api/signup", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                username,
                password,
                role: document.getElementById("role").value
            })
        })
        .then(r => r.json())
        .then(d => {
            if (d.message === "Signup successful") {
                alert("Account created! Please sign in.");
                toggleMode();
            } else {
                msg.innerText = d.message;
            }
        });

    } else {
        fetch("/api/signin", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password })
        })
        .then(r => r.json())
        .then(d => {
            if (d.role) {
                saveUser(d);
                if (d.role === "driver") location.href = "driver.html";
                if (d.role === "user") location.href = "user.html";
                if (d.role === "admin") location.href = "admin.html";
            } else {
                msg.innerText = d.message;
            }
        });
    }
}
</script>

</body>
</html>
