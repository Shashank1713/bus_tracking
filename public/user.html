<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">
<style>#map{height:100vh}</style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="/socket.io/socket.io.js"></script>

<script>
const map=L.map("map").setView([15.85,74.5],13);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

const busIcon=L.icon({
 iconUrl:"https://cdn-icons-png.flaticon.com/512/3774/3774299.png",
 iconSize:[48,48]
});

const markers={};
const socket=io();

socket.on("fleetUpdate",buses=>{
 for(const id in buses){
  const {lat,lon}=buses[id];
  if(!markers[id]){
   markers[id]=L.marker([lat,lon],{icon:busIcon}).addTo(map);
  }else{
   markers[id].setLatLng([lat,lon]);
  }
  map.setView([lat,lon],16);
 }
});
</script>
</body>
</html>
