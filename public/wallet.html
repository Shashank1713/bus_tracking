<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wallet</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <style>
    body{margin:0;background:#eef2f8;font-family:Manrope,sans-serif;color:#1a2238;padding:16px}
    .card{width:min(560px,100%);margin:0 auto;background:#fff;border:1px solid #d7dfec;border-radius:16px;padding:14px;box-shadow:0 8px 22px rgba(25,39,74,.08)}
    h1{margin:0 0 10px;color:#2f43a6}
    .bal{font-size:1.5rem;font-weight:900;color:#1a2238}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    input{min-height:40px;border:1px solid #cfd8ea;border-radius:10px;padding:0 10px;flex:1}
    .btn{min-height:40px;border:none;border-radius:999px;padding:0 14px;font-weight:800;cursor:pointer}
    .btn.add{background:#f5cf0d;color:#1b2438}
    .btn.back{background:#e7edff;color:#2f43a6}
    .msg{margin-top:8px;color:#2f43a6;font-weight:700;min-height:22px}
  </style>
</head>
<body>
  <main class="card">
    <h1>Wallet</h1>
    <p class="bal" id="balance">Rs 0</p>
    <div class="row">
      <input id="amount" type="number" min="1" placeholder="Add amount" />
      <button id="add" class="btn add" type="button">Add Funds</button>
    </div>
    <div class="row">
      <button class="btn back" type="button" onclick="window.location.href='my-profile.html'">Back</button>
    </div>
    <p id="msg" class="msg"></p>
  </main>

  <script>
    const token = localStorage.getItem("appToken");
    if (!token) window.location.href = "login.html";

    async function loadBalance() {
      const res = await fetch("/api/wallet", { headers: { Authorization: `Bearer ${token}` } });
      const payload = await res.json();
      if (!res.ok) {
        document.getElementById("msg").textContent = payload.error || "Unable to load wallet";
        return;
      }
      document.getElementById("balance").textContent = `Rs ${payload.balance}`;
    }

    document.getElementById("add").onclick = async () => {
      const amount = Number(document.getElementById("amount").value || 0);
      if (!(amount > 0)) {
        document.getElementById("msg").textContent = "Enter valid amount";
        return;
      }
      const res = await fetch("/api/wallet/add-funds", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({ amount })
      });
      const payload = await res.json();
      if (!res.ok) {
        document.getElementById("msg").textContent = payload.error || "Unable to add funds";
        return;
      }
      document.getElementById("msg").textContent = "Wallet updated";
      loadBalance();
    };

    loadBalance();
  </script>
</body>
</html>
