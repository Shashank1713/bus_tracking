<!DOCTYPE html>
<html>
<head>
  <title>Admin</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body{margin:0;background:#020617;color:white}
    #map{height:100vh}
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script>
  const map=L.map("map").setView([15.85,74.5],12);
  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

  const busIcon=L.icon({
    iconUrl:"https://cdn-icons-png.flaticon.com/512/1068/1068631.png",
    iconSize:[46,46],
    iconAnchor:[23,23]
  });

  const socket=io(), markers={};

  socket.on("fleetUpdate", buses=>{
    Object.keys(buses).forEach(id=>{
      if(!markers[id]){
        markers[id]=L.marker([buses[id].lat,buses[id].lon],{icon:busIcon})
          .addTo(map).bindPopup(id);
      } else {
        markers[id].setLatLng([buses[id].lat,buses[id].lon]);
      }
    });
  });
</script>

</body>
</html>
